<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>项目匹配系统</title>
    <link rel="stylesheet" href="/css/projectmatch.css">
    <style>
        /* 新增样式 */
        .management-panel {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #dee2e6;
        }

        .management-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #495057;
        }

        .management-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .btn-primary {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .btn-primary:hover {
            background-color: #0056b3;
        }

        .btn-danger {
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .btn-danger:hover {
            background-color: #c82333;
        }

        .btn-warning {
            background-color: #ffc107;
            color: #212529;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .btn-warning:hover {
            background-color: #e0a800;
        }

        .btn-secondary {
            background-color: #6c757d;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .btn-secondary:hover {
            background-color: #545b62;
        }

        .checkbox-col {
            width: 40px;
            text-align: center;
        }

        .action-col {
            width: 150px;
            text-align: center;
        }

        /* 模态框样式 */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border-radius: 8px;
            width: 80%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #dee2e6;
        }

        .modal-title {
            font-size: 18px;
            font-weight: bold;
            margin: 0;
        }

        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            background: none;
            border: none;
        }

        .close:hover {
            color: #000;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #495057;
        }

        .form-control {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
        }

        .form-control:focus {
            border-color: #007bff;
            outline: 0;
            box-shadow: 0 0 0 2px rgba(0,123,255,0.25);
        }

        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #dee2e6;
        }

        .checkbox-group {
            max-height: 150px;
            overflow-y: auto;
            border: 1px solid #ced4da;
            border-radius: 4px;
            padding: 10px;
        }

        .checkbox-item {
            margin-bottom: 8px;
        }

        .checkbox-item:last-child {
            margin-bottom: 0;
        }

        .alert {
            padding: 12px;
            margin-bottom: 15px;
            border-radius: 4px;
        }

        .alert-success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .alert-danger {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .batch-actions {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            padding: 10px;
            background: #e9ecef;
            border-radius: 4px;
        }

        #selectAll {
            margin-right: 5px;
        }

        /* 任务模态框样式 */
        .tasks-content {
            margin: 20px 0;
        }

        .tasks-summary {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            border-left: 4px solid #007bff;
        }

        .tasks-filters {
            margin-bottom: 20px;
        }

        .tasks-filters .btn {
            margin-right: 10px;
            padding: 6px 12px;
            border: 1px solid #007bff;
            background: white;
            color: #007bff;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .tasks-filters .btn.active {
            background: #007bff;
            color: white;
        }

        .tasks-filters .btn:hover {
            background: #007bff;
            color: white;
        }

        .tasks-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
            border-radius: 4px;
        }

        .task-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .task-item:last-child {
            border-bottom: none;
        }

        .task-item:hover {
            background: #f8f9fa;
        }

        .task-info {
            flex: 1;
        }

        .task-name {
            font-weight: bold;
            margin-bottom: 5px;
            color: #495057;
        }

        .task-details {
            font-size: 12px;
            color: #6c757d;
        }

        .task-status {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-completed {
            background: #d4edda;
            color: #155724;
        }

        .task-actions {
            display: flex;
            gap: 5px;
        }

        .task-actions .btn {
            padding: 4px 8px;
            font-size: 11px;
            border-radius: 3px;
            cursor: pointer;
            border: none;
        }

        .btn-edit {
            background: #ffc107;
            color: #212529;
        }

        .btn-delete {
            background: #dc3545;
            color: white;
        }

        .btn-edit:hover {
            background: #e0a800;
        }

        .btn-delete:hover {
            background: #c82333;
        }

        .no-tasks {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }
    </style>
</head>
<body>

<h2>项目匹配系统</h2>

<!-- 项目管理面板 -->
<div class="management-panel">
    <div class="management-title">项目管理</div>
    <div class="management-buttons">
        <button class="btn-primary" onclick="showCreateProjectModal()">+ 新增项目</button>
        <button class="btn-danger" onclick="deleteSelectedProjects()">批量删除</button>
        <button class="btn-secondary" onclick="refreshData()">刷新数据</button>
    </div>
</div>

<h2>项目匹配筛选</h2>
<p style="color: #666; margin-bottom: 20px;">
    <strong>使用说明：</strong>选择搜索类型后输入相应的关键词。支持按项目名称模糊搜索或按员工ID查找其参与的项目。可添加多个搜索条件进行组合搜索。
</p>

<form id="filterForm">
    <div id="filterContainer">
        <!-- 动态生成筛选行 -->
    </div>
    <button type="button" id="addBtn" onclick="addFilterRow()">+ 增加条件</button>
    <button type="button" onclick="doSearch()">搜索</button>
</form>

<h3>匹配结果</h3>

<!-- 批量操作栏 -->
<div class="batch-actions" id="batchActions" style="display: none;">
    <label>
        <input type="checkbox" id="selectAll" onchange="toggleSelectAll()">
        全选
    </label>
    <span id="selectedCount">已选中 0 项</span>
</div>

<table id="resultTable">
    <thead>
    <tr>
        <th class="checkbox-col" id="headerCheckbox" style="display: none;">
            <input type="checkbox" id="headerSelectAll" onchange="toggleSelectAll()">
        </th>
        <!-- 新增点击排序 -->
        <th style="cursor:pointer" onclick="toggleSort()">
            id <span id="sortIcon">⇅</span>
        </th>
        <th>项目名称</th>
        <th>状态</th>
        <th>启动时间</th>
        <th>所需技能</th>
        <th>团队成员</th>
        <th>任务状态</th>
        <th class="action-col" id="actionHeader" style="display: none;">操作</th>
    </tr>
    </thead>
    <tbody><!-- 动态填充 --></tbody>
    <!-- 分页控制 -->
    <tfoot>
    <tr>
        <td colspan="8" class="page-bar">
            <button id="btnFirst" onclick="gotoFirst()">首页</button>
            <button id="btnPrev"  onclick="changePage(-1)">上一页</button>

            <span class="page-jump">
        第
        <input type="number" id="pageInput" min="1" onkeypress="if(event.key==='Enter') jumpToPage()">
        页
        <button onclick="jumpToPage()">跳转</button>
      </span>

            <button id="btnNext" onclick="changePage(1)">下一页</button>
            <button id="btnLast" onclick="gotoLast()">尾页</button>

            <span id="pageInfo" class="page-info"></span>
        </td>
    </tr>
    </tfoot>
</table>

<!-- 新增/编辑项目模态框 -->
<div id="projectModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title" id="modalTitle">新增项目</h3>
            <button class="close" onclick="closeProjectModal()">&times;</button>
        </div>

        <div id="modalAlert" style="display: none;"></div>

        <form id="projectForm">
            <div class="form-group">
                <label class="form-label">项目ID</label>
                <input type="number" id="projectId" class="form-control" readonly>
                <small class="form-text text-muted">新增时自动生成，编辑时显示</small>
            </div>

            <div class="form-group">
                <label class="form-label">项目名称 *</label>
                <input type="text" id="projectName" class="form-control" required>
            </div>

            <div class="form-group">
                <label class="form-label">项目状态</label>
                <select id="projectStatus" class="form-control">
                    <option value="0">未归档</option>
                    <option value="1">已归档</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">启动时间</label>
                <input type="datetime-local" id="startDate" class="form-control">
            </div>

            <div class="form-group">
                <label class="form-label">所需技能</label>
                <input type="text" id="projectSkills" class="form-control" placeholder="请输入技能ID，多个技能用逗号分隔（如：1,2,3）">
                <small class="form-text text-muted">输入技能ID，多个技能用英文逗号分隔</small>
                <div id="skillPreview" class="skill-preview" style="margin-top: 5px; font-size: 12px; color: #666;"></div>
            </div>

            <div class="form-group">
                <label class="form-label">团队成员</label>
                <input type="text" id="projectMembers" class="form-control" placeholder="请输入员工ID，多个员工用逗号分隔（如：101,102,103）">
                <small class="form-text text-muted">输入员工ID，多个员工用英文逗号分隔</small>
                <div id="memberPreview" class="member-preview" style="margin-top: 5px; font-size: 12px; color: #666;"></div>
            </div>
        </form>

        <div class="form-actions">
            <button type="button" class="btn-secondary" onclick="closeProjectModal()">取消</button>
            <button type="button" class="btn-primary" onclick="saveProject()">保存</button>
        </div>
    </div>
</div>

<!-- 项目任务查看模态框 -->
<div id="tasksModal" class="modal">
    <div class="modal-content" style="max-width: 800px;">
        <div class="modal-header">
            <h3 class="modal-title" id="tasksModalTitle">项目任务</h3>
            <button class="close" onclick="closeTasksModal()">&times;</button>
        </div>

        <div id="tasksModalAlert" style="display: none;"></div>

        <div class="tasks-content">
            <div class="tasks-summary" id="tasksSummary">
                <!-- 任务统计信息 -->
            </div>

            <div class="tasks-filters">
                <button class="btn btn-sm" onclick="filterTasks('all')" id="filterAll">全部任务</button>
                <button class="btn btn-sm" onclick="filterTasks('pending')" id="filterPending">未完成</button>
                <button class="btn btn-sm" onclick="filterTasks('completed')" id="filterCompleted">已完成</button>
            </div>

            <div class="tasks-list" id="tasksList">
                <!-- 任务列表 -->
            </div>
        </div>

        <div class="form-actions">
            <button type="button" class="btn-secondary" onclick="closeTasksModal()">关闭</button>
            <button type="button" class="btn-primary" onclick="addNewTask()">+ 新增任务</button>
        </div>
    </div>
</div>

<!-- 任务新增模态框 -->
<div id="createTaskModal" class="modal">
    <div class="modal-content" style="max-width: 500px;">
        <div class="modal-header">
            <h3 class="modal-title" id="createTaskModalTitle">新增任务</h3>
            <button class="close" onclick="closeCreateTaskModal()">&times;</button>
        </div>

        <div id="createTaskModalAlert" style="display: none;"></div>

        <form id="createTaskForm">
            <div class="form-group">
                <label class="form-label">任务名称 *</label>
                <input type="text" id="taskName" class="form-control" required placeholder="请输入任务名称">
            </div>

            <div class="form-group">
                <label class="form-label">负责人ID</label>
                <input type="number" id="taskManagerId" class="form-control" placeholder="请输入负责人员工ID（如：101）">
                <small class="form-text text-muted">输入负责人的员工ID</small>
            </div>

            <div class="form-group">
                <label class="form-label">任务状态</label>
                <select id="taskStatus" class="form-control">
                    <option value="0">未完成</option>
                    <option value="1">已完成</option>
                </select>
            </div>
        </form>

        <div class="form-actions">
            <button type="button" class="btn-secondary" onclick="closeCreateTaskModal()">取消</button>
            <button type="button" class="btn-primary" onclick="saveNewTask()">保存任务</button>
        </div>
    </div>
</div>

<!-- 任务编辑模态框 -->
<div id="editTaskModal" class="modal">
    <div class="modal-content" style="max-width: 500px;">
        <div class="modal-header">
            <h3 class="modal-title" id="editTaskModalTitle">编辑任务</h3>
            <button class="close" onclick="closeEditTaskModal()">&times;</button>
        </div>

        <div id="editTaskModalAlert" style="display: none;"></div>

        <form id="editTaskForm">
            <div class="form-group">
                <label class="form-label">任务ID</label>
                <input type="number" id="editTaskId" class="form-control" readonly>
                <small class="form-text text-muted">任务ID（只读）</small>
            </div>

            <div class="form-group">
                <label class="form-label">项目ID</label>
                <input type="number" id="editTaskProjId" class="form-control" readonly>
                <small class="form-text text-muted">所属项目ID（只读）</small>
            </div>

            <div class="form-group">
                <label class="form-label">任务名称 *</label>
                <input type="text" id="editTaskName" class="form-control" required placeholder="请输入任务名称">
            </div>

            <div class="form-group">
                <label class="form-label">负责人ID</label>
                <input type="number" id="editTaskManagerId" class="form-control" placeholder="请输入负责人员工ID（如：101）">
                <small class="form-text text-muted">输入负责人的员工ID</small>
            </div>

            <div class="form-group">
                <label class="form-label">任务状态</label>
                <select id="editTaskStatus" class="form-control">
                    <option value="0">未完成</option>
                    <option value="1">已完成</option>
                </select>
            </div>
        </form>

        <div class="form-actions">
            <button type="button" class="btn-secondary" onclick="closeEditTaskModal()">取消</button>
            <button type="button" class="btn-primary" onclick="saveEditTask()">保存修改</button>
        </div>
    </div>
</div>

<script src="/js/projectmatch.js"></script>
</body>
</html>